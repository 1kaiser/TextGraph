<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text as Graph - Exact Distill Implementation</title>
    
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    
    <!-- MathJax for font rendering consistency -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="module" crossorigin src="./assets/index-BpX3p64J.js"></script>
  <link rel="stylesheet" crossorigin href="./assets/index-B7bFG-yC.css">
</head>
<body>
    <div class="text-input-section" style="position: fixed; top: calc(100vh - 200px); left: 20px; width: 350px; background: rgba(255,255,255,0.95); border: 1px solid #ddd; border-radius: 8px; padding: 15px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: grab; transition: all 0.2s ease;">
        <div class="drag-handle" style="position: absolute; top: -8px; right: -8px; width: 16px; height: 16px; background: #dc3545; border-radius: 50%; cursor: grab; z-index: 1001; transition: background 0.2s ease;"></div>
        
        <!-- Paragraph Input Section (Collapsible) -->
        <div class="paragraph-section" style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="font-size: 12px; font-weight: 500; color: #555;">📄 Context Paragraph</div>
                <button id="toggle-paragraph" onclick="toggleParagraph()" style="background: none; border: none; cursor: pointer; font-size: 16px; color: #666;">▲</button>
            </div>
            <div id="paragraph-container" style="display: block;">
                <textarea id="paragraph-input" placeholder="Enter full paragraph for attention context..." maxlength="10000" style="width: 100%; height: 80px; padding: 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; font-family: monospace;">Neural networks are powerful machine learning models. Graph attention mechanisms capture complex relationships between words. These models can transform how we process natural language understanding.</textarea>
                <div style="font-size: 10px; color: #888; text-align: right; margin-top: 2px;">
                    <span id="para-char-count">179</span>/10000 chars
                </div>
            </div>
        </div>
        
        <!-- Query Sentence Section -->
        <div style="text-align: center; margin-bottom: 10px; font-size: 14px; font-weight: 500;">🎯 Query Sentence</div>
        <input type="text" id="manual-text-input" placeholder="Enter query sentence..." value="Graph attention mechanisms capture relationships" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
        <!-- Embedding Method Selection -->
        <div style="margin-bottom: 8px; font-size: 11px;">
            <label style="display: flex; align-items: center; gap: 4px;">
                <input type="radio" name="embedding-method" value="synthetic" checked style="margin: 0;">
                <span>🎲 Synthetic Embeddings (Fast)</span>
            </label>
            <label id="real-embedding-label" style="display: flex; align-items: center; gap: 4px; margin-top: 4px; opacity: 0.5; cursor: not-allowed;" title="Loading model...">
                <input type="radio" name="embedding-method" value="real" disabled style="margin: 0;">
                <span id="real-embedding-status">🧠 EmbeddingGemma (Loading...)</span>
            </label>
            <div id="model-status" style="font-size: 9px; color: #666; margin-top: 4px; display: none;"></div>
        </div>
        
        <div style="text-align: center; margin-top: 8px;">
            <button id="update-graph" onclick="updateVisualization()" style="background: #4285f4; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">🔄 Compute GAT</button>
        </div>
    </div>
        
    <!-- Full Width Graph -->
    <div id='text-as-graph' style="width: 100%; min-height: 400px; position: relative; cursor: grab;" class="draggable-graph"></div>
    
    <script>
        // Make the input box draggable and hoverable
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let initialLeft = 0;
        let initialTop = 0;
        
        const draggableBox = document.querySelector('.text-input-section');
        const dragHandle = document.querySelector('.drag-handle');
        
        // Add hover effects to the entire box
        draggableBox.addEventListener('mouseenter', () => {
            draggableBox.style.boxShadow = '0 8px 20px rgba(0,0,0,0.25)';
            draggableBox.style.transform = 'translateY(-2px)';
            dragHandle.style.background = '#ff4757';
        });
        
        draggableBox.addEventListener('mouseleave', () => {
            if (!isDragging) {
                draggableBox.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                draggableBox.style.transform = 'translateY(0px)';
                dragHandle.style.background = '#dc3545';
            }
        });
        
        // Make entire box draggable (not just the handle)
        function startDrag(e) {
            // Don't drag if clicking on input elements
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON') {
                console.log('🚫 Drag blocked: clicked on', e.target.tagName);
                return;
            }
            
            console.log('🎯 Starting drag from', e.target.className || e.target.tagName);
            
            isDragging = true;
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            
            const rect = draggableBox.getBoundingClientRect();
            initialLeft = rect.left;
            initialTop = rect.top;
            
            console.log('📍 Starting drag from position:', initialLeft, initialTop);
            
            draggableBox.style.cursor = 'grabbing';
            draggableBox.style.boxShadow = '0 8px 20px rgba(0,0,0,0.3)';
            e.preventDefault();
            e.stopPropagation();
        }
        
        // Add drag functionality to both handle and box
        dragHandle.addEventListener('mousedown', startDrag);
        draggableBox.addEventListener('mousedown', startDrag);
        
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const deltaX = e.clientX - dragStartX;
            const deltaY = e.clientY - dragStartY;
            
            const newLeft = Math.max(0, Math.min(window.innerWidth - 350, initialLeft + deltaX));
            const newTop = Math.max(0, Math.min(window.innerHeight - 200, initialTop + deltaY));
            
            console.log('🔄 Dragging to:', newLeft, newTop);
            
            draggableBox.style.left = newLeft + 'px';
            draggableBox.style.top = newTop + 'px';
            draggableBox.style.bottom = 'auto';
            draggableBox.style.right = 'auto';
        });
        
        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                draggableBox.style.cursor = 'grab';
                // Reset hover effects when dragging ends
                draggableBox.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                dragHandle.style.background = '#dc3545';
            }
            if (isGraphDragging) {
                isGraphDragging = false;
                graphContainer.style.cursor = 'grab';
            }
        });
        
        // Make the graph draggable
        let isGraphDragging = false;
        let graphDragStartX = 0;
        let graphDragStartY = 0;
        let graphInitialLeft = 0;
        let graphInitialTop = 0;
        
        const graphContainer = document.querySelector('.draggable-graph');
        
        graphContainer.addEventListener('mousedown', (e) => {
            // Don't drag if clicking on SVG elements (allow interaction)
            if (e.target.tagName === 'rect' || e.target.tagName === 'text' || e.target.tagName === 'path') {
                return;
            }
            
            isGraphDragging = true;
            graphDragStartX = e.clientX;
            graphDragStartY = e.clientY;
            
            const rect = graphContainer.getBoundingClientRect();
            graphInitialLeft = rect.left;
            graphInitialTop = rect.top;
            
            graphContainer.style.cursor = 'grabbing';
            graphContainer.style.position = 'fixed';
            graphContainer.style.left = graphInitialLeft + 'px';
            graphContainer.style.top = graphInitialTop + 'px';
            graphContainer.style.zIndex = '999';
            
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
            if (!isGraphDragging) return;
            
            const deltaX = e.clientX - graphDragStartX;
            const deltaY = e.clientY - graphDragStartY;
            
            const newLeft = Math.max(-200, Math.min(window.innerWidth - 200, graphInitialLeft + deltaX));
            const newTop = Math.max(-100, Math.min(window.innerHeight - 100, graphInitialTop + deltaY));
            
            graphContainer.style.left = newLeft + 'px';
            graphContainer.style.top = newTop + 'px';
        });
        
        // Paragraph section toggle functionality
        function toggleParagraph() {
            const container = document.getElementById('paragraph-container');
            const button = document.getElementById('toggle-paragraph');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                button.textContent = '▲';
            } else {
                container.style.display = 'none';
                button.textContent = '▼';
            }
        }
        
        // Update paragraph character count
        function updateParagraphCount() {
            const paraInput = document.getElementById('paragraph-input');
            const paraCount = document.getElementById('para-char-count');
            if (paraInput && paraCount) {
                paraCount.textContent = paraInput.value.length;
            }
        }
        
        // Add paragraph input event listener when DOM loads
        document.addEventListener('DOMContentLoaded', () => {
            const paraInput = document.getElementById('paragraph-input');
            if (paraInput) {
                paraInput.addEventListener('input', updateParagraphCount);
                updateParagraphCount(); // Set initial count
            }
        });
    </script>
</body>
</html>